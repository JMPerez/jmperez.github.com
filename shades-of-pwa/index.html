<!doctype html><html lang=en><head><meta name=generator content="Hexo 3.8.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta http-equiv=Accept-CH content="DPR, Viewport-Width, Width"><title>The different shades of Progressive Web Apps - José M. Pérez</title><meta name=description content="Taking advantage of PWA functionality on your site is easy. You don't need to go all-in using all the features. Just take what is needed for your use case."><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><link rel=author href=https://plus.google.com/107456024651797783420><link rel=alternate type=application/rss+xml title="Jose M. Perez" href=https://jmperezperez.com/feed.xml><meta name=twitter:card content=summary_large_image><meta name=twitter:url content="https://jmperezperez.com/shades-of-pwa/" property=og:url><meta name=twitter:title content="The different shades of Progressive Web Apps - José M. Pérez" property=og:title><meta name=twitter:description content="Taking advantage of PWA functionality on your site is easy. You don't need to go all-in using all the features. Just take what is needed for your use case." property=og:description><meta name=twitter:site content=@jmperezperez><meta property=og:image content=https://jmperezperez.com/assets/images/posts/shades-of-pwa/header.jpg><meta name=twitter:image content=https://jmperezperez.com/assets/images/posts/shades-of-pwa/header.jpg><meta property=fb:app_id content=1702266270006013><meta property=fb:pages content=1639848659664211><link rel=canonical href="https://jmperezperez.com/shades-of-pwa/"><style>*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;border:none;font:inherit;margin:0;padding:0;vertical-align:baseline}button,input{background:0 0}html{font-size:18px}@media (max-width:768px){html{font-size:16px}}body{background:#fff;color:#555;font-family:Georgia,Times;font-weight:300;font-style:normal;line-height:1.5rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5{color:#212121;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-weight:600;line-height:2rem;margin-bottom:1.5rem}#menu a,.button{font-size:1em;font-weight:400}.post ol,.post ul,amp-video,amp-vimeo,amp-youtube,iframe,p,video{margin:0;margin-bottom:1rem}twitterwidget{margin-bottom:1em!important}a{color:#2a7cb2;font-weight:inherit;text-decoration:none;transition:color .15s ease-out,border-bottom-color .15s ease-out}a:hover{color:#2a7cb2}abbr{border-bottom:1px dashed #ccc;text-decoration:none}p a{border-bottom:1px solid #eee}p a:hover{border-bottom-color:#212121}strong{font-weight:700}em{font-style:italic}h1{font-size:1.7rem}h2{color:#444;display:inline-block;font-size:1.6rem;font-weight:400;margin-top:1rem}h3{color:#666;display:inline-block;font-size:1.4rem;font-weight:400;margin-top:1rem}h4{font-size:1.18rem}h5{font-size:1rem}a h1,a h2,a h3,a h4,a h5{transition:color .15s ease-out}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#3498db}.quote{margin:0 0 15px 0}blockquote{border-left:2px solid #ccc;font-style:italic;margin:0 0 15px 0;padding-left:20px}ol,ul{margin:0 0 15px 0;padding-left:25px}ul{list-style:square}ol{list-style:decimal}hr{background:#eee;color:#eee;clear:both;display:block;height:2px;margin:30px auto;width:50%}code,pre{color:#333;font-family:Courier,Menlo,Monaco;font-size:.8em;letter-spacing:0;overflow-x:auto}pre{padding:.8em 1em;white-space:pre-wrap}code{margin:0}.post::after{display:block;clear:both;content:''}.main-header{background-color:#005689;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;overflow:hidden;margin-bottom:1.5rem;padding:1rem;position:relative;text-align:center;width:100%}#menu{display:inline-block;line-height:2rem}#menu a{color:#fff;font-size:.9rem;margin-left:1rem;padding:1rem .5rem;text-transform:uppercase}@media (max-width:500px){#menu a{margin-left:.5rem;padding:.5rem .25rem}}#menu a:first-child{margin-left:0}#menu a[aria-current]{font-weight:700}#page{margin:0 auto;max-width:41rem;padding-left:1.5rem;padding-right:1.5rem;position:relative}.videoWrapper{height:0;margin-bottom:1em;padding-bottom:56.25%;padding-top:25px;position:relative}.videoWrapper amp-youtube,.videoWrapper iframe{height:100%;left:0;position:absolute;top:0;width:100%}.wrapper{border-top:2px solid #eee;padding-top:2rem}.wrapper:first-child{border-top:none;padding-top:1rem}.posts-list h2{margin-top:0}.post{display:block;margin-bottom:2rem;width:100%}.post div[itemprop=articleBody]>p:first-child{color:#333}.post li{margin-bottom:.5rem}.post p+img{margin-bottom:1rem}.post p img{border:1px solid #eee;display:block;max-width:100%}.post img+.caption{padding-top:.5rem}.post .svg-container{margin-bottom:5%;max-width:100%;text-align:center}video{height:auto;max-width:100%}.post .svg-container object{width:100%}.tag-list{display:inline-block;list-style-type:none;margin:0;padding:0;padding-bottom:1rem}.tag-list-item{display:inline-block;margin-left:.8em}.pagination{padding-bottom:1rem;text-align:center}.pagination a{min-width:30px;max-height:30px;text-align:center}footer{border-top:1px dashed #ddd;padding:2em;text-align:center}.timing-stats{font-size:.7em;padding:.35em}.button{background-color:#fff;border:1px solid #555;border-radius:2rem;color:#555;display:inline-block;padding:.5rem 1rem;transition:background-color .15s ease-out}.button:hover{background-color:#3498db;border-color:transparent;color:#fff}.button.inactive{background-color:#ccc;color:#fff}.search-goog input{border:2px solid #ddd;padding:10px}.search-goog input[type=submit]{background-color:#ddd;cursor:pointer}@media (max-width:768px){#page,.wrapper{margin:0;max-width:100%;width:100%}.wrapper{padding-top:2rem}.wraper::after{clear:both;content:'';display:block}}.outscreen{height:1px;left:-1000px;overflow:hidden;position:absolute;top:auto;width:1px}.callout{border:1px solid #eee;border-left-color:#777;border-left-width:5px;border-radius:3px;font-size:.9rem;padding:20px;margin:20px 0}.author{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:.8rem;margin-bottom:1rem}.author .name{line-height:1rem;padding-top:.5rem}.bd,.media{overflow:hidden;zoom:1}.media .img{float:left}.avatar-img{border-radius:100%;height:3rem;margin-right:.5rem;width:3rem}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace;direction:ltr;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;font-size:.85em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:.2em;padding-top:1px;padding-bottom:1px;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#005cc5}.token.keyword{color:#d73a49}.token.atrule,.token.attr-name{color:#6f42c1}.token.deleted,.token.function{color:#6f42c1}.token.selector{color:#00009f}.token.tag{color:#22863a}.token.class-name{color:#6f42c1}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.caption{display:block;font-size:.8rem;text-align:center}.codepen-aspect-ratio>iframe{height:100%;position:absolute;width:100%}.twitter-tweet{margin-left:auto;margin-right:auto}.twitter-tweet::after{content:'';display:block;padding-bottom:20px;width:100%}.me{max-width:22rem;margin:0 auto 1rem;text-align:center}.me>div{height:8rem;margin:0 auto;position:relative;width:8rem}.me svg{border-radius:100%;height:100%;left:0;position:absolute;top:0;width:100%}.me img{border-radius:100%;height:100%;position:relative;width:100%}.me h1{font-size:1.7rem;line-height:2rem;margin-bottom:.5rem}@media (prefers-color-scheme:dark){body{background:#38444c;color:#eee}a{color:#9dcae8}a:hover{color:#fff}p a{border-bottom:1px solid #6d7a82}p a:hover{border-bottom:1px solid #fff}h1,h2,h3,h4,h5{color:#eee}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#4b89b1}.button:hover{background-color:#4b89b1}code,pre{color:#ddd}.main-header{background-color:#4b89b1}}</style><link rel=amphtml href="/shades-of-pwa/amp/"><meta name=theme-color content=#005689><link rel=manifest href=/manifest.json></head><body><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-39254352-1","auto"),ga("send","pageview");</script><header class=main-header><nav id=menu><a href="/">Blog</a> <a href="/projects/">Projects</a> <a href="/talks/">Speaking</a> <a href="/about-me/?ref=header">About</a></nav></header><div id=page><article class=wrapper><div class=post><header><script type=application/ld+json>{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "The different shades of Progressive Web Apps",
  
  "description": "Taking advantage of PWA functionality on your site is easy. You don't need to go all-in using all the features. Just take what is needed for your use case.",
  
  "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://jmperezperez.com/shades-of-pwa/"
  },
  "datePublished": "2018-11-02T12:44:00.000Z",
  "dateModified": "2018-12-16T17:51:46.000Z",
  
  "image": {
    "@type": "ImageObject",
    "url": "https://jmperezperez.com/assets/images/posts/shades-of-pwa/header.jpg",
    "width" : "1024",
    "height" : "683"
  },
  
  "author": {
      "@type": "Person",
      "name": "Jose M. Perez",
      "url": "https://jmperezperez.com",
      "sameAs": [
        "http://www.linkedin.com/in/jmperezperez",
        "https://twitter.com/jmperezperez"
      ]
  },
  "publisher": {
      "@type": "Organization",
      "name": "Jose M. Perez's Blog"
      
      ,
      "logo": {
        "@type": "ImageObject",
        "url": "https://jmperezperez.com/assets/images/logo.png",
        "width": 600,
        "height": 60
      }
      
  }
}</script><div class="media author"><div class=img><a href="/about-me/?ref=post-header"><img src=https://res.cloudinary.com/jmperez/image/upload/w_120,f_auto,c_scale/v1519156883/profile_ysrm5y.jpg class=avatar-img alt="" height=53 width=53 sizes=53px></a></div><div class=bd><address class=name itemprop=author itemscope="" itemtype=https://schema.org/Person><a href="/about-me/" itemprop=name>José M. Pérez</a></address><meta class=post-data itemprop=datePublished content=2018-11-02T12:44:00.000Z>November 2, 2018 <span style="margin:0 .5rem;display:inline-block">|</span> Reading Time: ~<time>10 mins</time></div></div><h1>The different shades of Progressive Web Apps</h1></header><p>Implementing a PWA or adapting an existing site to “become a PWA” can be daunting. There are many new technologies to learn about, but you don’t need to use all of them to improve your website performance and user experience greatly.</p><div style=position:relative;padding-bottom:66.6666%;margin-bottom:1rem><img style="max-width:100%; border: 0;position:absolute;top:0;left:0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541172389/shades-of-pwa/header.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541172389/shades-of-pwa/header.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541172389/shades-of-pwa/header.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541172389/shades-of-pwa/header.jpg 1400w" src=https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541172389/shades-of-pwa/header.jpg alt=""></div><p>On this post I will describe several use cases where Progressive Web Apps (PWA) can be useful to make your website achieve better performance and be more reliable.</p><a id=more></a><h2 id=What-are-Progressive-Web-Apps><a href=#What-are-Progressive-Web-Apps class=headerlink title="What are Progressive Web Apps"></a>What are Progressive Web Apps</h2><p>If you are a web developer you have probably heard about Progressive Web Apps (PWA). Web sites that load quick, are reliable, feel smooth and take advantage of modern APIs.</p><p>There is a lot of buzz about them, partly because Google coined the term and has been leading the implementation of the bits and pieces that composed it.</p><p>Implementing a PWA or adapting an existing site to “become a PWA” looks like a big endeavor. The same powerful marketing that has made PWA known in the developer community can be a blessing and a curse. Developers might get the wrong idea that either they use everything and make installable offline-capable push notifications-enabled websites, or they bail out. After all, <strong>PWA is just a way to coin a set of recent browser APIs and techniques, not all or nothing</strong>.</p><p>Every website’s use case is different and that is alright. If installing your website as an app is not something a user would do for your site, you don’t need to build that capability. <strong>You can still take advantage of some of the technologies powering PWAs</strong>. The main requirement is that your site runs on HTTPS and, in most cases, creating a ServiceWorker, which is not more than a Javascript file.</p><p>I want to describe some of the typical scenarios where you can applied elements from PWAs.</p><h2 id=Common-Use-Cases-to-Apply-Service-Workers-and-other-PWA-related-functionality><a href=#Common-Use-Cases-to-Apply-Service-Workers-and-other-PWA-related-functionality class=headerlink title="Common Use Cases to Apply Service Workers and other PWA-related functionality"></a>Common Use Cases to Apply Service Workers and other PWA-related functionality</h2><h3 id=Offline-mode-and-pre-caching><a href=#Offline-mode-and-pre-caching class=headerlink title="Offline mode and pre-caching"></a>Offline mode and pre-caching</h3><p>To get your site to load without a connection, the user needs to visit it and the site needs to run a Service Worker (SW)that will make content available offline. The SW can follow different strategies (eg serving cache first, making a network request first, etc). You can find strategies on <a href="https://jakearchibald.com/2014/offline-cookbook/" target=_blank rel=noopener>Jake Archibald’s Offline Cookbook</a> and <a href="https://serviceworke.rs/" target=_blank rel=noopener>serviceworke.rs</a>.</p><div style=position:relative;padding-bottom:49%;margin-bottom:1rem><img style="max-width:100%; border: 0; position: absolute; top: 0; left: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 1400w" src=https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png alt="Stale-while-revalidate” strategy, of the many explained on Jake Archibald’s Offline Cookbook"></div><p><small class=caption>“Stale-while-revalidate” strategy, of the many explained on <a href="https://jakearchibald.com/2014/offline-cookbook/" target=_blank rel=noopener>Jake Archibald’s Offline Cookbook</a>. If there’s a cached version available, use it, but fetch an update for next time.</small></p><p>The strategies that check the cache first can be used to fetch and pre-cache top-level navigation routes and other critical resources. Thus, the user gets a faster loading and rendering experience as they click around the PWA.</p><p>Offline support is something that can be added pretty much to any site, big or small. I run <a href=https://jmperezperez.com/sw.js>a simple SW</a> <a href=https://jmperezperez.com>on my blog</a> to download the main sections and the posts that the user reads.</p><pre class=language-js><code class=language-js><span class="token comment" spellcheck=true>// the cache version gets updated every time there is a new deployment</span>
<span class="token keyword">const</span> CACHE_VERSION <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CURRENT_CACHE <span class="token operator">=</span> <span class="token template-string"><span class="token string">`main-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>CACHE_VERSION<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>

<span class="token comment" spellcheck=true>// these are the routes we are going to cache for offline support</span>
<span class="token keyword">const</span> cacheFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'/about-me/'</span><span class="token punctuation">,</span> <span class="token string">'/projects/'</span><span class="token punctuation">,</span> <span class="token string">'/offline/'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck=true>// on activation we clean up the previously registered service workers</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">></span>
  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
        cacheNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>cacheName <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheName <span class="token operator">!==</span> CURRENT_CACHE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck=true>// on install we download the routes we want to cache for offline</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">></span>
  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>cacheFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck=true>// fetch the resource from the network</span>
<span class="token keyword">const</span> fromNetwork <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fulfill<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fulfill</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck=true>// fetch the resource from the browser cache</span>
<span class="token keyword">const</span> fromCache <span class="token operator">=</span> request <span class="token operator">=</span><span class="token operator">></span>
  caches
    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">></span>
      cache
        <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>matching <span class="token operator">=</span><span class="token operator">></span> matching <span class="token operator">||</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/offline/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck=true>// cache the current page to make it available for offline</span>
<span class="token keyword">const</span> update <span class="token operator">=</span> request <span class="token operator">=</span><span class="token operator">></span>
  caches
    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">></span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck=true>// general strategy when making a request (eg if online try to fetch it</span>
<span class="token comment" spellcheck=true>// from the network with a timeout, if something fails serve from cache)</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  evt<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    <span class="token function">fromNetwork</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fromCache</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token function">update</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>With great power comes great responsibility. Do not use SWs to abuse the user’s data connection, downloading content they will never need, just in case.</p><h3 id=Service-Workers-for-Multi-page-Applications><a href=#Service-Workers-for-Multi-page-Applications class=headerlink title="Service Workers for Multi-page Applications"></a>Service Workers for Multi-page Applications</h3><p>In a multi-page app (MPA), every route that a user navigates to triggers a full request of the page, along with associated scripts and styles needed, to the server.</p><p>A good example is <a href=https://ele.me target=_blank rel=noopener>ele.me</a>, the biggest food ordering and delivery company in mainland China. They used a SW to precache the main routes from their site, and implemented skeleton screens that are immediately shown while loading routes that aren’t cached.</p><div><img src=https://res.cloudinary.com/jmperez/image/upload/w_auto:100:350,f_auto,c_scale,w_600/v1541171672/shades-of-pwa/ele-me-skeleton-page.png sizes="(max-width: 768px) 50vw, 350px" alt="Processing a picture through Primitive using 10 shapes" style=width:48%;float:left;margin-right:2%;padding-bottom:10px> <img src=https://res.cloudinary.com/jmperez/image/upload/w_auto:100:350,f_auto,c_scale,w_600/v1541171587/shades-of-pwa/ele-me-full-load.png sizes="(max-width: 768px) 50vw, 350px" alt="Processing a picturethrough Primitive using 100 shapes" style=width:48%;float:left;margin-right:2%;padding-bottom:10px></div><p>You can read more about their approach on <a href=https://developers.google.com/web/showcase/2017/eleme target=_blank rel=noopener>Google Developers site</a> and <a href=https://medium.com/elemefe/upgrading-ele-me-to-progressive-web-app-2a446832e509 target=_blank rel=noopener>this in-depth post</a>.</p><h3 id=Bridging-the-gap-between-SPAs-and-server-side-rendered-sites><a href=#Bridging-the-gap-between-SPAs-and-server-side-rendered-sites class=headerlink title="Bridging the gap between SPAs and server-side rendered sites"></a>Bridging the gap between SPAs and server-side rendered sites</h3><p>Web development has gone through different stages</p><ol><li>Old sites used to be server-side rendered. Only minor interactions used Javascript in the client. Every page navigation meant a full page load.</li><li>Then we started creating more complex web experiences and moved all the logic (and templates) to client-side land. Everything was amazing as long as you waited a bit while staring at a blank page whose main purpose was to load a large JS bundle.</li><li>We realized that maybe we needed a hybrid solution. First request server-side rendered, then the rest happening client-side.</li></ol><p><strong>Reaching the third step involves doing server-side rendering.</strong> If you don’t want to duplicate templates and logic, the usual solution is to use NodeJS on the server. This is fun for web developers because we get to use the same language both on server and browser. In medium and large web projects it means rewriting existing working code from python/java/PHP/others to Javascript, and the typical nuances of adopting something different from the existing solution.</p><p>Server-side rendered sites have also a largely underestimated drawback. <strong>Putting content early on the screen is one thing. Making the content interactive is another.</strong> A page that renders quickly but then doesn’t respond to click/touch for seconds, while loads and executes the JS behemoth, results in frustration.</p><p>In web dev terms we are improving the <a href=https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint target=_blank rel=noopener>First Meaningful Paint</a> (‘FMP’), but we aren’t making any improvement in the <a href=https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive target=_blank rel=noopener>Time to Interactive</a> (‘TTI’).</p><p>This short version of Addy Osmani’s “The cost of JavaScript“ explains it very well:</p><div class=videoWrapper><iframe width=1764 height=1080 src=https://www.youtube.com/embed/qUFA1pAMfj4 frameborder=0 allowfullscreen></iframe></div><p><small class=caption>“<a href="https://www.youtube.com/watch?v=qUFA1pAMfj4" target=_blank rel=noopener>The cost of JavaScript</a>” by Addy Osmani. If you like it, there is also <a href="https://www.youtube.com/watch?v=63I-mEuSvGA" target=_blank rel=noopener>a longer version of the talk.</a></small></p><p>Paul Lewis also described the situation in his post “<a href="https://aerotwist.com/blog/when-everything-is-important-nothing-is/" target=_blank rel=noopener>When everything is important nothing is</a>”, and describes it as the <em>Uncanny Valley.</em></p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 1400w" src=https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg alt="Spotify web player shows an offline page when there is no internet connection"> <small class=caption>Rendering your app server-side. An image from “<a href="https://aerotwist.com/blog/when-everything-is-important-nothing-is/" target=_blank rel=noopener>When everything is important nothing is</a>”.</small></p><p>I have seen many cases when server-side rendering was proposed as the first step to improve the performance in a SPA. This left off the table ideas like bundle-splitting, which would have likely reduced both FMP and TTI.</p><blockquote><p>[…] <strong>you should avoid SSR if you don’t need it.</strong> Most modern web apps require sophisticated interaction with the UI that has to be driven by non-trivial amounts of JavaScript. If you need to write all of that JS anyway, and you <em>don’t</em> need the first page load benefits that SSR gives you, you’ll be better off just building a <a href=https://developers.google.com/web/fundamentals/architecture/app-shell target=_blank rel=noopener>static app shell</a> and avoiding the headaches of client-server code reuse, data re-hydration, and dynamic content cache invalidation. — <a href=https://blog.usejournal.com/when-should-i-server-side-render-c2a383ff2d0f target=_blank rel=noopener>When should I Server-Side Render?</a> by <a href=https://blog.usejournal.com/@mbleigh target=_blank rel=noopener>Michael Bleigh</a></p></blockquote><p>Single Page Applications that are not server-side rendered can take great advantage from using Service Workers. In most cases the browser requests some data and injects it in a JS template or component. This means that the browser can cache the JS code and the data independently.</p><p>The site can then follow different strategies. For instance, it can load immediately with stale data, similar to what usually happens with native apps. It can also decide to render a skeleton while the data is fetched. In any case, it makes an approach like <a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/" target=_blank rel=noopener>PRPL</a>, easy to implement.</p><h3 id=Installable-Website><a href=#Installable-Website class=headerlink title="Installable Website"></a>Installable Website</h3><p>You might want to make your website installable, close to what everyone knows as an “app”. For this you don’t need many to use many capabilities from the web. As long as your site runs on HTTPS you just need a web manifest, an icon and a ServiceWorker. You can find documentation on <a href="https://developers.google.com/web/fundamentals/app-install-banners/" target=_blank rel=noopener>Google’s Developer site</a> and <a href=https://developer.mozilla.org/en-US/docs/Web/Apps/Progressive/Installable_PWAs target=_blank rel=noopener>MDN</a>.</p><p>Your site doesn’t need to be fully functional offline to make it installable. Take for instance Spotify’s Progressive Web App.</p><div class=videoWrapper><iframe width=560 height=315 src=https://www.youtube.com/embed/EvcjSldzQ1E frameborder=0 allowfullscreen></iframe></div><p><small class=caption>Spotify’s Web Player works as an installable PWA.</small></p><p>As you see, the PWA is installable, yet it doesn’t have support for offline navigation nor playback. When there is no connection, the PWA shows this custom page:</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 1400w" src=https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541171689/shades-of-pwa/spotify-offline.png alt="Spotify web player shows an offline page when there is no internet connection"></p><p>Installable PWAs are not limited to mobile. They are already supported on <a href=https://developers.google.com/web/progressive-web-apps/desktop target=_blank rel=noopener>ChromeOS, Windows and Linux</a>, and pretty soon on Mac too (Chrome 72+).</p><h4 id=More-features-enabled-by-Service-Workers><a href=#More-features-enabled-by-Service-Workers class=headerlink title="More features enabled by Service Workers"></a>More features enabled by Service Workers</h4><p>I have only talked about some use cases for ServiceWorkers and other elements of PWAs, but there are more. Browsers can show <a href="https://developers.google.com/web/fundamentals/push-notifications/" target=_blank rel=noopener>push notifications</a> after the user has enabled it for a certain site, and the push notifications are delivered even when the site is not opened. This makes it ideal for reengage with users without having to wait for them to visit your site again.</p><p>You can also use <a href=https://developers.google.com/web/updates/2015/12/background-sync target=_blank rel=noopener>background sync</a>, ideally for schedule data sending beyond the life of the page. Think of uploading pictures or sending chat messages even after the user leaves the page.</p><h3 id=More-Resources><a href=#More-Resources class=headerlink title="More Resources"></a>More Resources</h3><p>I love reading about real sites that have adopted PWAs and have shared their findings. I particularly like <a href="https://www.youtube.com/watch?v=aCMbSyngXB4" target=_blank rel=noopener>Addy Osmani’s talk “Production Progressive Web Apps With JavaScript Frameworks”</a>, showcasing some case studies from large web sites that have been integrating these technologies to improve their key metrics.</p><div class=videoWrapper><iframe width=1764 height=1080 src=https://www.youtube.com/embed/aCMbSyngXB4 frameborder=0 allowfullscreen></iframe></div><p>They are good examples to demonstrate that you don’t need to re-architecture an existing site to use PWA goodness, and that you can apply some of these concepts and see improvements in perceived performance very quickly.</p></div><hr>Tags:<ul class=tag-list><li class=tag-list-item><a class=tag-list-link href="/tags/pwa/">pwa</a></li></ul></article></div><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){})["catch"](function(n){})});</script><footer><section class=links><a href=https://twitter.com/jmperezperez>@jmperezperez</a> on Twitter · <a href=https://github.com/JMPerez>GitHub</a> · <a href=https://www.linkedin.com/in/jmperezperez>LinkedIn</a> · <a href=https://medium.com/@jmperezperez>Medium</a></section><div class=timing-stats></div></footer><script>window.addEventListener('load', () => {
     setTimeout(() => {
      var t = window.performance && performance.timing;
      function round2(num) { return Math.round(num * 100) / 100; }
      if (t) {
        var timingStats = document.querySelector('.timing-stats');
        var loadTime = (t.loadEventEnd - t.navigationStart) / 1000;
        var timingStatsHTML = 'This page loaded in ' + round2(loadTime) + ' seconds. ';
        var performanceEntries = performance.getEntriesByType('paint');
        performanceEntries.forEach(function(performanceEntry, i, entries) {
          var name = performanceEntry.name;
          if (name === 'first-paint') {
            name = '<abbr title=' + name + '>FP</abbr>';
          } else if (name === 'first-contentful-paint') {
            name = '<abbr title=' + name + '>FCP</abbr>';
          }
          timingStatsHTML += name + ' was ' + round2(performanceEntry.startTime / 1000) + ' seconds. ';
        });
        timingStatsHTML += '<a href="https://jmperezperez.com/page-load-footer/">More info</a>.';
        timingStats.innerHTML = timingStatsHTML;
      }
    }, 0);
   });
   !function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.quicklink=n()}(this,function(){var e={};function n(e){return new Promise(function(n,t){var r=new XMLHttpRequest;r.open("GET",e,r.withCredentials=!0),r.onload=function(){200===r.status?n():t()},r.send()})}var t,r,i=(t="prefetch",((r=document.createElement("link")).relList||{}).supports&&r.relList.supports(t)?function(e){return new Promise(function(n,t){var r=document.createElement("link");r.rel="prefetch",r.href=e,r.onload=n,r.onerror=t,document.head.appendChild(r)})}:n);function o(t,r,o){if(!(e[t]||(o=navigator.connection)&&((o.effectiveType||"").includes("2g")||o.saveData)))return(r?function(e){return null==self.fetch?n(e):fetch(e,{credentials:"include"})}:i)(t).then(function(){e[t]=!0})}var u=u||function(e){var n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)},c=new Set,f=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var n=e.target.href;c.has(n)&&a(n)}})});function a(e){c.delete(e),o(new URL(e,location.href).toString(),f.priority)}return function(e){e=Object.assign({timeout:2e3,priority:!1,timeoutFn:u,el:document},e),f.priority=e.priority;var n=e.origins||[location.hostname],t=e.ignores||[];e.timeoutFn(function(){e.urls?e.urls.forEach(a):Array.from(e.el.querySelectorAll("a"),function(e){f.observe(e),n.length&&!n.includes(e.hostname)||function e(n,t){return Array.isArray(t)?t.some(function(t){return e(n,t)}):(t.test||t).call(t,n.href,n)}(e,t)||c.add(e.href)})},{timeout:e.timeout})}});quicklink();</script></body></html>