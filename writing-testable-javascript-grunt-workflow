<!doctype html><html lang=en><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="DPR, Viewport-Width, Width" http-equiv=Accept-CH><title>Modular Javascript + Grunt - José M. Pérez</title><link href=//res.cloudinary.com rel=dns-prefetch /><meta content="I am a software engineer who loves web development. Speaker and open-source contributor." name=description><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name=viewport><link href=https://plus.google.com/107456024651797783420 rel=author /><link href=https://jmperezperez.com/feed.xml rel=alternate title="Jose M. Perez" type=application/rss+xml><meta content=summary name=twitter:card><meta content=https://jmperezperez.com//writing-testable-javascript-grunt-workflow name=twitter:url property=og:url><meta content="Modular Javascript + Grunt" name=twitter:title property=og:title><meta content=@jmperezperez name=twitter:site><meta content=https://res.cloudinary.com/jmperez/image/upload/f_auto,c_scale/v1519156883/profile_ysrm5y.jpg property=og:image><meta content=https://res.cloudinary.com/jmperez/image/upload/f_auto,c_scale/v1519156883/profile_ysrm5y.jpg name=twitter:image><meta content=1702266270006013 property=fb:app_id><meta content=1639848659664211 property=fb:pages /><link href=https://jmperezperez.com//writing-testable-javascript-grunt-workflow rel=canonical /><style>*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;border:none;font:inherit;margin:0;padding:0;vertical-align:baseline}button,input{background:0 0}html{font-size:18px}@media (max-width:768px){html{font-size:16px}}body{background:#fff;color:#555;font-family:Georgia,Times;font-weight:300;font-style:normal;line-height:1.5rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5{color:#212121;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:600;line-height:2rem;margin-bottom:1.5rem}#menu a,.button{font-size:1em;font-weight:400}.post ol,.post ul,amp-video,amp-vimeo,amp-youtube,iframe,p,video{margin:0;margin-bottom:1rem}twitterwidget{margin-bottom:1em!important}a{color:#2a7cb2;font-weight:inherit;text-decoration:none;transition:color .15s ease-out,border-bottom-color .15s ease-out}a:hover{color:#2a7cb2}abbr{border-bottom:1px dashed #ccc;text-decoration:none}p a{border-bottom:1px solid #eee}p a:hover{border-bottom-color:#212121}strong{font-weight:700}em{font-style:italic}h1{font-size:1.7rem}h2{color:#444;display:inline-block;font-size:1.6rem;font-weight:400;margin-top:1rem}h3{color:#666;display:inline-block;font-size:1.4rem;font-weight:400;margin-top:1rem}h4{font-size:1.18rem}h5{font-size:1rem}a h1,a h2,a h3,a h4,a h5{transition:color .15s ease-out}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#3498db}.quote{margin:0 0 15px 0}blockquote{border-left:2px solid #ccc;font-style:italic;margin:0 0 15px 0;padding-left:20px}ol,ul{margin:0 0 15px 0;padding-left:25px}ul{list-style:square}ol{list-style:decimal}hr{background:#eee;color:#eee;clear:both;display:block;height:2px;margin:30px auto;width:50%}code,pre{color:#333;font-family:Courier,Menlo,Monaco;font-size:.8em;letter-spacing:0;overflow-x:auto}pre{padding:.8em 1em;white-space:pre-wrap}code{margin:0}.post::after{display:block;clear:both;content:""}.main-header{background-color:#005689;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;overflow:hidden;margin-bottom:1.5rem;padding:1rem;position:relative;text-align:center;width:100%}#menu{display:inline-block;line-height:2rem}#menu a{color:#fff;font-size:.9rem;margin-left:1rem;padding:1rem .5rem;text-transform:uppercase}@media (max-width:500px){#menu a{margin-left:.5rem;padding:.5rem .25rem}}#menu a:first-child{margin-left:0}#menu a[aria-current]{font-weight:700}#page{margin:0 auto;max-width:41rem;padding-left:1.5rem;padding-right:1.5rem;position:relative}.videoWrapper{height:0;margin-bottom:1em;padding-bottom:56.25%;padding-top:25px;position:relative}.videoWrapper amp-youtube,.videoWrapper iframe{height:100%;left:0;position:absolute;top:0;width:100%}.wrapper{border-top:2px solid #eee;padding-top:2rem}.wrapper:first-child{border-top:none;padding-top:1rem}.posts-list h2{margin-top:0}.post{display:block;margin-bottom:2rem;width:100%}.post div[itemprop=articleBody]>p:first-child{color:#333}.post li{margin-bottom:.5rem}.post p+img{margin-bottom:1rem}.post p img{border:1px solid #eee;display:block;max-width:100%}.post img+.caption,.post img+figcaption{padding-top:.5rem}.post .svg-container{margin-bottom:5%;max-width:100%;text-align:center}figure{padding-bottom:1em}video{height:auto;max-width:100%}.post .svg-container object{width:100%}.tag-list{display:inline-block;list-style-type:none;margin:0;padding:0;padding-bottom:1rem}.tag-list-item{display:inline-block;margin-left:.8em}.pagination{padding-bottom:1rem;text-align:center}.pagination a{min-width:30px;max-height:30px;text-align:center}footer{border-top:1px dashed #ddd;padding:2em;text-align:center}.timing-stats{font-size:.7em;padding:.35em}.button{background-color:#fff;border:1px solid #555;border-radius:2rem;color:#555;display:inline-block;padding:.5rem 1rem;transition:background-color .15s ease-out}.button:hover{background-color:#3498db;border-color:transparent;color:#fff}.button.inactive{background-color:#ccc;color:#fff}.search-goog input{border:2px solid #ddd;padding:10px}.search-goog input[type=submit]{background-color:#ddd;cursor:pointer}@media (max-width:768px){#page,.wrapper{margin:0;max-width:100%;width:100%}.wrapper{padding-top:2rem}.wraper::after{clear:both;content:"";display:block}}.outscreen{height:1px;left:-1000px;overflow:hidden;position:absolute;top:auto;width:1px}.callout{border:1px solid #eee;border-left-color:#777;border-left-width:5px;border-radius:3px;font-size:.9rem;padding:20px;margin:20px 0}.author{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.8rem;margin-bottom:1rem}.author .name{line-height:1rem;padding-top:.5rem}.bd,.media{overflow:hidden;zoom:1}.media .img{float:left}.avatar-img{border-radius:100%;height:3rem;margin-right:.5rem;width:3rem}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace;direction:ltr;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;font-size:.85em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:.2em;padding-top:1px;padding-bottom:1px;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#005cc5}.token.keyword{color:#d73a49}.token.atrule,.token.attr-name{color:#6f42c1}.token.deleted,.token.function{color:#6f42c1}.token.selector{color:#00009f}.token.tag{color:#22863a}.token.class-name{color:#6f42c1}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.caption,figcaption{display:block;font-size:.8rem;text-align:center}.codepen-aspect-ratio>iframe{height:100%;position:absolute;width:100%}.twitter-tweet{margin-left:auto;margin-right:auto}.twitter-tweet::after{content:"";display:block;padding-bottom:20px;width:100%}.me{max-width:22rem;margin:0 auto 1rem;text-align:center}.me>div{height:8rem;margin:0 auto;position:relative;width:8rem}.me svg{border-radius:100%;height:100%;left:0;position:absolute;top:0;width:100%}.me img{border-radius:100%;height:100%;position:relative;width:100%}.me h1{font-size:1.7rem;line-height:2rem;margin-bottom:.5rem}.read-next{background-color:#fdf6ea;margin:2rem 0;padding:1em}@media (prefers-color-scheme:dark){body{background:#38444c;color:#eee}a{color:#9dcae8}a:hover{color:#fff}p a{border-bottom:1px solid #6d7a82}p a:hover{border-bottom:1px solid #fff}h1,h2,h3,h4,h5{color:#eee}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#4b89b1}.button:hover{background-color:#4b89b1}code,pre{color:#ddd}.main-header{background-color:#4b89b1}.read-next{background-color:#020915}}.amp-img-wrapper{position:absolute;height:100%;width:100%}</style><link href=https://webmention.io/jmperezperez.com/webmention rel=webmention /><link href=https://webmention.io/jmperezperez.com/xmlrpc rel=pingback /><meta content=#005689 name=theme-color><link href=/manifest.json rel=manifest><meta content="Hexo 5.4.0" name=generator></head><body><header class=main-header><nav id=menu><a href=/ >Blog</a> <a href=/projects/ >Projects</a> <a href=/talks/ >Speaking</a> <a href=/about-me/ >About</a></nav></header><div id=page><article class=wrapper><div class=post><header><script type=application/ld+json>{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Modular Javascript + Grunt",
  
  "description": "Like if it was a new year’s resolution, a few weeks ago I decided I
wanted to become a better JS programmer. It’s not that I was a bad one,
but I felt I wasn’t coding in a maintainable and testable way.
I wanted to make sure I didn’t commit JS code with syntax errors, lint
errors or functional errors. And I think I have improved this a lot
after reading about writing testable code and embracing
Grunt.",
  
  "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://jmperezperez.com//writing-testable-javascript-grunt-workflow"
  },
  "datePublished": "2013-09-07T13:42:12.000Z",
  "dateModified": "2018-12-16T17:51:46.000Z",
  
  "author": {
      "@type": "Person",
      "name": "Jose M. Perez",
      "url": "https://jmperezperez.com",
      "sameAs": [
        "http://www.linkedin.com/in/jmperezperez",
        "https://twitter.com/jmperezperez"
      ]
  },
  "publisher": {
      "@type": "Organization",
      "name": "Jose M. Perez's Blog"
      
  }
}</script><div class="media author"><div class=img><a href="/about-me/?ref=post-header"><img alt="" src=https://res.cloudinary.com/jmperez/image/upload/w_120,f_auto,c_scale/v1519156883/profile_ysrm5y.jpg class=avatar-img height=53 sizes=53px width=53></a></div><div class=bd><address class=name itemprop=author itemscope itemtype=https://schema.org/Person><a href=/about-me/ itemprop=name>José M. Pérez</a></address><meta content=2013-09-07T13:42:12.000Z class=post-data itemprop=datePublished>September 7, 2013<span style="margin:0 .5rem;display:inline-block">|</span> Reading Time: ~<time>4 mins</time></div></div><h1>Modular Javascript + Grunt</h1></header><p>Like if it was a new year’s resolution, a few weeks ago I decided I wanted to become a better JS programmer. It’s not that I was a bad one, but I felt I wasn’t coding in a maintainable and testable way.</p><p>I wanted to make sure I didn’t commit JS code with syntax errors, lint errors or functional errors. And I think I have improved this a lot after reading about writing testable code and embracing Grunt.</p><span id=more></span><h2 id=First-things-first-Read-a-bit-on-it><a href=#First-things-first-Read-a-bit-on-it class=headerlink title="First things first. Read a bit on it."></a>First things first. Read a bit on it.</h2><p>It is definitely worth it reading if you care about testing JS code. <img alt="Testable JavaScript by Mark Ethan Trostler" src=/assets/images/posts/testable-javascript.jpg></p><p>I grabbed the <a href=http://shop.oreilly.com/product/0636920024699.do rel=noopener target=_blank>Testable JavaScript</a> book and took it home. Read through it and realize I was doing it wrong. I had implemented browser tests before using Selenium. Those also cover indirectly your JS code, but they take longer to run and introduce dependencies over other modules. They are good for testing the whole thing, but not something that can be so quickly run that you do it every time you save a file.</p><blockquote><p>Write code that you can test. If you can unit test it, better. You will end up with small modules you can reuse in other projects. - I said to myself</p></blockquote><p>I have probably been coupling too much my JS code with the final output. For instance, I was reluctant of creating new files only to get smaller modules. I felt it wasn’t worth it for the size of the components I was making and there wasn’t much reusable code across projects.</p><p>And I didn’t like the idea of exposing variables and functions which were meant to be private, both because they increase the final code size and because those functions are not to be used from outside.</p><blockquote><p>Write as many modules as you need. Each one of them in a different file with a single responsibility - I promised to myself</p></blockquote><p>But by doing so, you can isolate a module, see at a glance what its purpose is, and implement tests covering it without taking into account how it is used in the context of the big webapp. Implement unit tests for them. Each unit test covering one module. Implement mocks and stubs for the modules the one your are testing depend on. Then, make you main function depend on them.</p><h2 id=Improving-your-workflow><a href=#Improving-your-workflow class=headerlink title="Improving your workflow"></a>Improving your workflow</h2><p>It feels very well when you manage to improve your daily workflow. I didn’t know until I was seeing myself more confident about the code I was writing.</p><p>How? I run JSHint on the files as I save them. Lint them. Run unit tests. Easily combine files and minify them. Using preprocessor? No prob. Say hello to <a href=http://gruntjs.com/ rel=noopener target=_blank>Grunt</a>.</p><p>If you are not familiar with Grunt, check it out. And create a blank project using it. In my case it was useful to see side by side a <a href=http://gruntjs.com/sample-gruntfile rel=noopener target=_blank>basic config for grunt</a> and a more complete one created with the webapp generator for <a href=http://yeoman.io/ rel=noopener target=_blank>yeoman</a>.</p><p>There are plugins for most of the features you need. And if not, it is quite easy to create one. In my case, I started with a basic Gruntfile.js, and I tried to understand what was going on. I was introducing plugins step by step, reading through the options for each of them. These are the plugins I am using:</p><ul><li><a href=https://github.com/gruntjs/grunt-contrib-jshint rel=noopener target=_blank>JSHint</a>: I was pretty happy just having this plugin. It keeps your code consistent with coding standards and makes it easy to spot syntax errors.</li><li>Unit test with <a href=https://github.com/gruntjs/grunt-contrib-connect rel=noopener target=_blank>Connect</a> + <a href=https://github.com/kmiyashiro/grunt-mocha rel=noopener target=_blank>Mocha</a>: It makes it possible to run client side unit tests written using Mocha on a headless browser.</li><li>Combination + minification of CSS and JS with <a href=https://github.com/yeoman/grunt-usemin rel=noopener target=_blank>usemin</a>: It deals with concatenation and minification of static files, plus modifying the reference properly (i.e. from your index.html).</li><li>Asset revisioning with <a href=https://github.com/cbas/grunt-rev rel=noopener target=_blank>rev</a>: You change the contents of a static file, the name changes. No more ‘clean the cache and try again’ issues.</li><li>String replacement with <a href=https://github.com/outaTiME/grunt-replace rel=noopener target=_blank>replace</a>: Useful for basic string replacement. I use it to apply different values depending on whether I am going to run the code on a dev environment or on the live one.</li></ul><p>If you are having problems with your workflow, maybe Grunt can help. In my case it has enhance my productivity by not having to run manually lots of commands, and to a web developer it feels more natural than dealing with make files.</p></div><hr/>Tags:<ul class=tag-list itemprop=keywords><li class=tag-list-item><a href=/tags/testing/ rel=tag class=tag-list-link>testing</a></li><li class=tag-list-item><a href=/tags/workflow/ rel=tag class=tag-list-link>workflow</a></li></ul></article></div><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){}).catch(function(n){})})</script><footer><section class=links><a href=https://twitter.com/jmperezperez rel="me noopener" target=_blank>@jmperezperez</a> on Twitter · <a href=https://github.com/JMPerez rel="me noopener" target=_blank>GitHub</a> · <a href=https://www.linkedin.com/in/jmperezperez rel=noopener target=_blank>LinkedIn</a> · <a href=https://medium.com/@jmperezperez rel=noopener target=_blank>Medium</a></section><div class=timing-stats></div></footer><script>window.addEventListener("load",()=>{setTimeout(()=>{var e,r,t=window.performance&&performance.timing;function i(e){return Math.round(100*e)/100}t&&(e=document.querySelector(".timing-stats"),r="This page loaded in "+i((t.loadEventEnd-t.navigationStart)/1e3)+" seconds. ",performance.getEntriesByType("paint").forEach(function(e,t,n){var a=e.name;"first-paint"===a?a="<abbr title="+a+">FP</abbr>":"first-contentful-paint"===a&&(a="<abbr title="+a+">FCP</abbr>"),r+=a+" was "+i(e.startTime/1e3)+" seconds. "}),r+='<a href="https://jmperezperez.com/page-load-footer/">More info</a>.',e.innerHTML=r)},0)})</script><script async src=/quicklink.js></script><script async src=https://unpkg.com/turbolinks@5.2.0/dist/turbolinks.js data-turbolinks-suppress-warning></script></body></html>