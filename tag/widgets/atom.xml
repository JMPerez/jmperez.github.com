<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jose M. Perez&#39;s Blog</title>
  <subtitle>Web development, performance, and some other good practices.</subtitle>
  <link href="/tag/widgets/atom.xml" rel="self"/>
  
  <link href="https://jmperezperez.com/"/>
  <updated>2018-12-16T17:51:46.000Z</updated>
  <id>https://jmperezperez.com/</id>
  
  <author>
    <name>Jose M. Perez</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Tips to implement an embeddable widget</title>
    <link href="https://jmperezperez.com//embeddable-widget"/>
    <id>https://jmperezperez.com//embeddable-widget</id>
    <published>2013-12-19T16:41:06.000Z</published>
    <updated>2018-12-16T17:51:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>Embeddable widgets (or gadgets) allow users to easily include
functionality provided by another site. Some examples are <a href="https://about.twitter.com/resources/buttons">Twitter
button</a> or the
<a href="https://developers.facebook.com/docs/plugins/like-button/">Facebook like button</a>,
but also more complex ones
like <a href="https://disqus.com/websites/">Disqus comments</a>. They can be included on a site easily,
normally through an <code>iframe</code> or some JS snippet which will create an
iframe. Although at first sight these widgets seem basic, lots of things
need to be taken into account when implementing one.</p>
<span id="more"></span>

<h2 id="Embeddable-code"><a href="#Embeddable-code" class="headerlink" title="Embeddable code"></a>Embeddable code</h2><p>These widgets are meant to be easy to add to any site. And the style and functionality of the widget shouldn’t be affected by that from the page in which it is being embedded.</p>
<p>A natural solution for this problem is to use <code>iframe</code>s. The iframe can be included directly, or injected using a snippet of Javascript code. Using the Javascript code has several advantages:</p>
<ul>
<li>It can expose an API to manipulate the widget and subscribe to
events triggered by it more naturally (more on that later).</li>
<li>Users can control better when to show the iframe (lazy loading).
Although with iframes it is possible, it is more explicit when using
JS.</li>
<li>Passing parameters to the widget feels better than doing the same
through a <code>data</code> attribute. And it allows passing parameters such as
JSON objects or functions that more awkward to include as a <code>data</code>
attribute.</li>
<li>The same JS code can add more functionalities, like generating other
types of buttons or even providing a whole Javascript SDK.</li>
<li>It allows listening to <code>resize</code> events and change the layout of the
widget accordingly.</li>
</ul>
<p>It also has some disadvantages:</p>
<ul>
<li>Sometimes it is not possible for users to include custom JS code
where they want to include the widget.</li>
<li>Includes an extra request for a script file. In most of the cases
the script will just be injecting the iframe, in a similar way as
other scripts for other widgets. Thus, a regular site can end up
requesting many JS files doing something very similar. I recommend
you to have a look at <a href="https://www.phpied.com/c3po-common-3rd-party-objects/">C3PO</a>
which explains a common loader for this kind of widgets.</li>
</ul>
<p>You can read more on the differences between providing an iframe code
snippet or a JS one on <a href="https://stackoverflow.com/questions/5359815/widget-design-what-is-better-iframes-or-javascript">StackOverflow</a>.</p>
<h2 id="Other-things-to-consider"><a href="#Other-things-to-consider" class="headerlink" title="Other things to consider"></a>Other things to consider</h2><p>There are a few things we need to keep in mind, like versioning, how we pass options or performance.</p>
<h3 id="Versioning"><a href="#Versioning" class="headerlink" title="Versioning"></a>Versioning</h3><p>Releasing a new version of the widget and see it automatically updated
on every site is a great experience. But if your change is a breaking
one (i.e. different attributes, different size…) then you need to
create a different version of the widget, or will break the sites using
it. So make sure you include an identifier for the version in the URL
for your iframe or the JS resource in the snippet.</p>
<h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><p>Most widgets allows customisation through a set of options. These
usually include:</p>
<ul>
<li><strong>Target</strong>: If you are liking a page it will be the URL of the page.
If you are following a user it will be the identifier for the user.</li>
<li><strong>Layout</strong>: Different layouts for different sizes of the button.</li>
<li><strong>Theme</strong>: Light / dark. You might want your widget to have a
transparent background so it merges with that on the site. In that
case, be careful with the color of your text because it can become
unreadable.</li>
<li><strong>Locale</strong>: The language that will be used to localise the text of
the widget (see the <a href="#localisation">Localisation section</a> for more info).
<img src="/assets/images/posts/youtube-subscribe-button.png" alt="Youtube Subscribe Button"></li>
</ul>
<p><em>Notice the light and dark themes and try to foresee what would happen if
you embed the light one in a dark site.</em></p>
<p>These options are normally specified as data attributes in the iframe, or passed to the JS function that creates the widget if using a JS snippet.</p>
<h3 id="Browser-compatibility"><a href="#Browser-compatibility" class="headerlink" title="Browser compatibility"></a>Browser compatibility</h3><p>Most basic widgets like buttons should not I would encourage you to support as many browsers as possible. You don’t have as much control on the device capabilities and the type of user as if you were coding a full web page, so try to make your widget work in every possible scenario.</p>
<h3 id="Performance-and-making-it-async"><a href="#Performance-and-making-it-async" class="headerlink" title="Performance (and making it async)"></a>Performance (and making it async)</h3><p>Your widget will affect the performance of the sites using it. Thus, it
is important to follow the usual rules (see PageSpeed, YSlow). Try also
to use scarcely large libraries. In addition, you should not use
<code>document.write</code>, or the page using it will block rendering. If your
snippet needs to load a JS file, do it in a async way. If not, if the
request for your file fails, it will become a <a href="https://www.stevesouders.com/blog/2011/10/13/frontend-spof-survery/">SPOF</a>.</p>
<p>The best way is using an <a href="https://calendar.perfplanet.com/2013/browser-wishlist-2013/#async3pc">async snippet</a>. The general pattern is:</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> d <span class="token operator">=</span> document<span class="token punctuation">,</span>
    h <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    s <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  s<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'/js/myfile.js'</span><span class="token punctuation">;</span>
  h<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You can find plenty of examples on <a href="https://web.archive.org/web/20170106194526/https://developers.google.com/speed/docs/insights/UseAsync">this list of
popular scripts with async loading</a>.</p>
<h3 id="Localisation"><a href="#Localisation" class="headerlink" title="Localisation"></a>Localisation</h3><p>If you want to localise your widget, there are several options. You can detect the language by reading the HTTP <code>Accept-Language</code> header sent in the request, and localise your widget accordingly. Thus, it will be rendered using the preferred user’s language, and you could default to English if you can’t provide a localisation for the languages listed in the header.</p>
<p>Even though that is a good solution, the widget can still be rendered in a language different from the language of the rest of the page in which your widget has been embedded, which is not optimal. A better solution is to support an option in the embed code so the page can force a specific locale for the widget.</p>
<p>You may need to adjust the width of the widget to accommodate different languages.</p>
<p>The localisation also applies to numbers. If your widget shows a quantity (i.e. the amount of likes, followers, subscribers) take into account the localisation for the number. Also, you may consider rounding the number, which also should be localised. Thus, 24,356,000 could become ‘24M’ in English, or ‘24 millones’ in Spanish, where ‘24M’ would be ambiguous.</p>
<p>If you are interested in rounding, <a href="http://jsfiddle.net/sUVFC/">here you have a jsFiddle showing the algorithm used in Twitter’s Follow Button</a>.</p>
<h2 id="Useful-resources"><a href="#Useful-resources" class="headerlink" title="Useful resources"></a>Useful resources</h2><p>If you are thinking of using a SDK, I definitely recommend checking out <a href="https://github.com/hueitan/javascript-sdk-design">this JavaScript SDK design guide</a>.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Build widgets that don’t affect the performance of the sites using it,
and strive for compatibility.</p>
]]></content>
    
    <summary type="html">
    
      What to use to embed a widget? Iframe or Javascript snippet? In this post I explain their pros and cons when deciding how you want users to embed your widget.
    
    </summary>
    
    
      <category term="widgets" scheme="https://jmperezperez.com/tags/widgets/"/>
    
  </entry>
  
  <entry>
    <title>Using C3PO to load Spotify Play Button</title>
    <link href="https://jmperezperez.com//c3po-spotify-play-button"/>
    <id>https://jmperezperez.com//c3po-spotify-play-button</id>
    <published>2013-04-06T10:22:30.000Z</published>
    <updated>2018-12-16T17:51:46.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.phpied.com/c3po-common-3rd-party-objects/">C3PO is a small library developed by Stoyan Stefanov</a> (I bet you know him, otherwise you should) as a way of getting rid off 3rd party Javascript code to load social widgets.</p>
<p>It allows injecting these widgets as iframes, instead of defining their containers and use certain 3rd party JS code to create and inject those iframes. In addition, it provides a simple <code>parse</code> function that you can call whenever you want to initialize these widgets. In addition, it exposes a way to send messages from the widget to the parent page using <code>postMessage</code>. In his example, the widget sends a <code>resize</code> message, that the parent element captures and changes the size of that widget accordingly.</p>
<span id="more"></span>
<p>I wanted to give it a look and, while I was at it, try to include a Spotify Play Button using the same approach. And it turns out it works. Have a look at <a href="http://jsfiddle.net/LZHgX/">this jsFiddle showing the button in action</a>, along with the social widgets from <a href="http://www.phpied.com/files/c3po/c3po.html">Stoyan’s example</a>.</p>
<p>In the case of the SPB widget, it doesn’t really use 3rd party JS code to load it. The Embed Code, as provided in <a href="https://developer.spotify.com/technologies/spotify-play-button/">its documentation page</a>, consists of an iframe pointing to a url that receives a Spotify URI. Its dimensions are specified as attributes of the iframe. When the widget loads, it checks what the dimensions of its iframe are, and adapts the size (and the look) of the widget to the available size. I am setting these dimensions using CSS to its parent <code>&lt;div class=&quot;spotify-play-button&quot;&gt;&lt;/div&gt;</code> element. Thus, if there is a JS error somewhere preventing the iframe injection, we won’t show an empty box.</p>
<ul>
<li>  <a href="http://jsfiddle.net/9wT7z/">Demo with the Spotify Play Button only</a></li>
<li><a href="http://jsfiddle.net/LZHgX/">Demo with the Spotify Play Button together with the rest of
  widgets</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://www.phpied.com/c3po-common-3rd-party-objects/&quot;&gt;C3PO is a small library developed by Stoyan Stefanov&lt;/a&gt; (I bet you know him, otherwise you should) as a way of getting rid off 3rd party Javascript code to load social widgets.&lt;/p&gt;
&lt;p&gt;It allows injecting these widgets as iframes, instead of defining their containers and use certain 3rd party JS code to create and inject those iframes. In addition, it provides a simple &lt;code&gt;parse&lt;/code&gt; function that you can call whenever you want to initialize these widgets. In addition, it exposes a way to send messages from the widget to the parent page using &lt;code&gt;postMessage&lt;/code&gt;. In his example, the widget sends a &lt;code&gt;resize&lt;/code&gt; message, that the parent element captures and changes the size of that widget accordingly.&lt;/p&gt;
    
    </summary>
    
    
      <category term="spotify play button" scheme="https://jmperezperez.com/tags/spotify-play-button/"/>
    
      <category term="widgets" scheme="https://jmperezperez.com/tags/widgets/"/>
    
  </entry>
  
</feed>
