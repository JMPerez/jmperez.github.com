<!doctype html>
<html ⚡>
  <head>
    <meta charset="utf-8">
    <link rel="canonical" href="https://jmperezperez.com/shades-of-pwa/" >
    <title>The different shades of Progressive Web Apps - Web development, performance, and some other good practices.</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
		<meta name="twitter:card" content="summary_large_image">
		<meta name="twitter:title" content="The different shades of Progressive Web Apps - José M. Pérez" property="og:title">
		<meta name="twitter:description" content="Taking advantage of PWA functionality on your site is easy. You don&#39;t need to go all-in using all the features. Just take what is needed for your use case." property="og:description">
		<meta name="twitter:site" content="@jmperezperez">
		
		<meta property="og:image" content="https://jmperezperez.com/assets/images/posts/shades-of-pwa/header.jpg">
		<meta name="twitter:image" content="https://jmperezperez.com/assets/images/posts/shades-of-pwa/header.jpg">
		
    <noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    
    <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    

    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script type="application/ld+json">
		{
			"@context": "http://schema.org",
			"@type": "BlogPosting",
			"headline": "The different shades of Progressive Web Apps",
			
			"description": "Taking advantage of PWA functionality on your site is easy. You don&#39;t need to go all-in using all the features. Just take what is needed for your use case.",
			
			"mainEntityOfPage":{
			    "@type":"WebPage",
			    "@id":"shades-of-pwa/"
			},
			"datePublished": "2018-11-02T12:44:00.000Z",
			"dateModified": "2018-12-16T17:51:46.000Z",
			
			"image": {
				"@type": "ImageObject",
				"url": "https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541172389/shades-of-pwa/header.jpg",
				"width" : "700",
				"height" : "467"
			},
			
			"author": {
			    "@type": "Person",
			    "name": "Jose M. Perez"
			},
			"publisher": {
			    "@type": "Organization",
			    "name": "Jose M. Perez&#39;s Blog"
			    
			    ,
			    "logo": {
			      "@type": "ImageObject",
			      "url": "https://jmperezperez.com/amp-dist/logo.png",
			      "width": 600,
			      "height": 60
			    }
			    
			}
		}
	</script>
	<style amp-custom>
		
			/*--RESET--*/
* {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  border: none;
  font: inherit;
  margin: 0;
  padding: 0;
  vertical-align: baseline;
}

input,
button {
  background: none;
}

html {
  font-size: 18px;
}

@media (max-width: 768px) {
  html {
    font-size: 16px;
  }
}

/*--BODY--*/

body {
  background: #fff;
  color: #555;
  font-family: Georgia, Times;
  font-weight: 300;
  font-style: normal;
  line-height: 1.5rem;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-size-adjust: 100%; /* fixes a too large font issue in horizontally scrollable <pre> on webkit */
}

h1,
h2,
h3,
h4,
h5 {
  color: #212121;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-weight: 600;
  line-height: 2rem;
  margin-bottom: 1.5rem;
}

#menu a,
.button {
  font-size: 1em;
  font-weight: 400;
}

p,
.post ul,
.post ol,
iframe,
video,
amp-video,
amp-vimeo,
amp-youtube {
  margin: 0;
  margin-bottom: 1rem;
}

twitterwidget {
  margin-bottom: 1em ;
}

a {
  color: #2a7cb2;
  font-weight: inherit;
  text-decoration: none;
  transition: color 0.15s ease-out, border-bottom-color 0.15s ease-out;
}

a:hover {
  color: #2a7cb2;
}

abbr {
  border-bottom: 1px dashed #ccc;
  text-decoration: none;
}

p a {
  border-bottom: 1px solid #eee;
}

p a:hover {
  border-bottom-color: #212121;
}

strong {
  font-weight: bold;
}

em {
  font-style: italic;
}

h1 {
  font-size: 1.7em;
}

h2 {
  color: #444;
  display: inline-block;
  font-size: 1.6rem;
  font-weight: 400;
  margin-top: 1rem;
}

h3 {
  color: #666;
  display: inline-block;
  font-size: 1.4rem;
  font-weight: 400;
  margin-top: 1rem;
}

h4 {
  font-size: 1.18rem;
}

h5 {
  font-size: 1rem;
}

a h1,
a h2,
a h3,
a h4,
a h5 {
  transition: color 0.15s ease-out;
}

a:hover h1,
a:hover h2,
a:hover h3,
a:hover h4,
a:hover h5 {
  color: #3498db;
}

.quote {
  margin: 0 0 15px 0;
}

blockquote {
  border-left: 2px solid #ccc;
  font-style: italic;
  margin: 0 0 15px 0;
  padding-left: 20px;
}

ul,
ol {
  margin: 0 0 15px 0;
  padding-left: 25px;
}

ul {
  list-style: square;
}

ol {
  list-style: decimal;
}

hr {
  background: #eee;
  color: #eee;
  clear: both;
  display: block;
  height: 2px;
  margin: 30px auto;
  width: 50%;
}

pre,
code {
  color: #333;
  font-family: Courier, Menlo, Monaco;
  font-size: 0.8em;
  letter-spacing: 0px;
  overflow-x: auto;
}

pre {
  padding: 0.8em 1em;
  white-space: pre-wrap;
}

code {
  margin: 0;
}

/*--CLEARFIXES--*/

.post::after {
  display: block;
  clear: both;
  content: '';
}

/*--HEADER--*/

.main-header {
  background-color: #005689;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  overflow: hidden;
  margin-bottom: 1.5rem;
  padding: 1rem;
  position: relative;
  text-align: center;
  width: 100%;
}

/*--MENU--*/

#menu {
  display: inline-block;
  line-height: 2rem;
}

#menu a {
  color: #fff;
  font-size: 0.9rem;
  margin-left: 1rem;
  padding: 1rem 0.5rem;
  text-transform: uppercase;
}

@media (max-width: 500px) {
  #menu a {
    margin-left: 0.5rem;
    padding: 0.5rem 0.25rem;
  }
}

#menu a:first-child {
  margin-left: 0;
}

#menu a[aria-current] {
  font-weight: bold;
}

/*--PAGE--*/

#page {
  margin: 0 auto;
  max-width: 41rem;
  padding-left: 1.5rem;
  padding-right: 1.5rem;
  position: relative;
}

.videoWrapper {
  height: 0;
  margin-bottom: 1em;
  padding-bottom: 56.25%; /* 16:9 */
  padding-top: 25px;
  position: relative;
}

.videoWrapper iframe,
.videoWrapper amp-youtube {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

/*--WRAPPER--*/

.wrapper {
  border-top: 2px solid #eee;
  padding-top: 2rem;
}

.wrapper:first-child {
  border-top: none;
  padding-top: 1rem;
}

.posts-list h2 {
  margin-top: 0;
}

/*--POSTS--*/

.post {
  display: block;
  margin-bottom: 2rem;
  width: 100%;
}

.post div[itemprop='articleBody'] > p:first-child {
  color: #333;
}

.post li {
  margin-bottom: 0.5rem;
}

.post p + img {
  margin-bottom: 1rem;
}

.post p img {
  border: 1px solid #eee;
  display: block;
  max-width: 100%;
}

.post img + .caption {
  padding-top: 0.5rem;
}

.post .svg-container {
  margin-bottom: 5%;
  max-width: 100%;
  text-align: center;
}

video {
  height: auto;
  max-width: 100%;
}

.post .svg-container object {
  width: 100%;
}

.tag-list {
  display: inline-block;
  list-style-type: none;
  margin: 0;
  padding: 0;
  padding-bottom: 1rem;
}

.tag-list-item {
  display: inline-block;
  margin-left: 0.8em;
}

/*--PAGINATION--*/

.pagination {
  padding-bottom: 1rem;
  text-align: center;
}

.pagination a {
  min-width: 30px;
  max-height: 30px;
  text-align: center;
}

/*--FOOTER--*/

footer {
  border-top: 1px dashed #ddd;
  padding: 2em;
  text-align: center;
}

.timing-stats {
  font-size: 0.7em;
  padding: 0.35em;
}

/*--BUTTONS--*/

.button {
  background-color: #fff;
  border: 1px solid #555;
  border-radius: 2rem;
  color: #555;
  display: inline-block;
  padding: 0.5rem 1rem;
  transition: background-color 0.15s ease-out;
}

.button:hover {
  background-color: #3498db;
  border-color: transparent;
  color: #fff;
}

.button.inactive {
  background-color: #ccc;
  color: #fff;
}

/*--404--*/
.search-goog input {
  border: 2px solid #ddd;
  padding: 10px;
}

.search-goog input[type='submit'] {
  background-color: #ddd;
  cursor: pointer;
}

@media (max-width: 768px) {
  /*--PAGE--*/

  #page,
  .wrapper {
    margin: 0;
    max-width: 100%;
    width: 100%;
  }

  /*--WRAPPER--*/

  .wrapper {
    padding-top: 2rem;
  }

  .wraper::after {
    clear: both;
    content: '';
    display: block;
  }
}

/*--ACCESSIBILITY--*/
.outscreen {
  height: 1px;
  left: -1000px;
  overflow: hidden;
  position: absolute;
  top: auto;
  width: 1px;
}

/*--CALLOUT--*/
.callout {
  border: 1px solid #eee;
  border-left-color: #777;
  border-left-width: 5px;
  border-radius: 3px;
  font-size: 90%;
  padding: 20px;
  margin: 20px 0;
}

.author {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-size: 0.8rem;
  margin-bottom: 1rem;
}

.author .name {
  line-height: 1rem;
  padding-top: 0.5rem;
}

.media,
.bd {
  overflow: hidden;
  _overflow: visible;
  
}

.media .img {
  float: left;
}

.avatar-img {
  border-radius: 100%;
  height: 3rem;
  margin-right: 0.5rem;
  width: 3rem;
}

/* SYNTAX HIGHLIGHTING */

code[class*='language-'],
pre[class*='language-'] {
  color: #393a34;
  font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier,
    monospace;
  direction: ltr;
  text-align: left;
  white-space: pre-wrap;
  word-spacing: normal;
  word-break: normal;
  font-size: 0.85em;
  line-height: 1.2em;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

pre[class*='language-']::-moz-selection,
pre[class*='language-'] ::-moz-selection,
code[class*='language-']::-moz-selection,
code[class*='language-'] ::-moz-selection {
  background: #b3d4fc;
}

pre[class*='language-']::selection,
pre[class*='language-'] ::selection,
code[class*='language-']::selection,
code[class*='language-'] ::selection {
  background: #b3d4fc;
}

/* Code blocks */
pre[class*='language-'] {
  padding: 1em;
  margin: 0.5em 0;
  overflow: auto;
  border: 1px solid #dddddd;
  background-color: white;
}

:not(pre) > code[class*='language-'],
pre[class*='language-'] {
}

/* Inline code */
:not(pre) > code[class*='language-'] {
  padding: 0.2em;
  padding-top: 1px;
  padding-bottom: 1px;
  background: #f8f8f8;
  border: 1px solid #dddddd;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
  color: #999988;
  font-style: italic;
}

.token.namespace {
  opacity: 0.7;
}

.token.string,
.token.attr-value {
  color: #e3116c;
}
.token.punctuation,
.token.operator {
  color: #393a34; /* no highlight */
}

.token.entity,
.token.url,
.token.symbol,
.token.number,
.token.boolean,
.token.variable,
.token.constant,
.token.property,
.token.regex,
.token.inserted {
  color: #005cc5;
}

.token.keyword {
  color: #d73a49;
}

.token.atrule,
.token.attr-name {
  color: #6f42c1;
}

.token.function,
.token.deleted {
  color: #6f42c1;
}

.token.selector {
  color: #00009f;
}

.token.tag {
  color: #22863a;
}

.token.class-name {
  color: #6f42c1;
}

.token.important,
.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}

.caption {
  display: block;
  font-size: 0.8rem;
  text-align: center;
}

.codepen-aspect-ratio > iframe {
  height: 100%;
  position: absolute;
  width: 100%;
}

.twitter-tweet {
  margin-left: auto;
  margin-right: auto;
}

.twitter-tweet::after {
  content: '';
  display: block;
  padding-bottom: 20px;
  width: 100%;
}

.me {
  max-width: 22rem;
  margin: 0 auto 1rem;
  text-align: center;
}

.me > div {
  height: 8rem;
  margin: 0 auto;
  position: relative;
  width: 8rem;
}

.me svg {
  border-radius: 100%;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.me img {
  border-radius: 100%;
  height: 100%;
  position: relative;
  width: 100%;
}

.me h1 {
  font-size: 1.7rem;
  line-height: 2rem;
  margin-bottom: 0.5rem;
}

@media (prefers-color-scheme: dark) {
  body {
    background: #38444c;
    color: #eee;
  }
  a {
    color: #9dcae8;
  }
  a:hover {
    color: #fff;
  }
  p a {
    border-bottom: 1px solid #6d7a82;
  }
  p a:hover {
    border-bottom: 1px solid #fff;
  }
  h1,
  h2,
  h3,
  h4,
  h5 {
    color: #eee;
  }
  a:hover h1,
  a:hover h2,
  a:hover h3,
  a:hover h4,
  a:hover h5 {
    color: #4b89b1;
  }
  .button:hover {
    background-color: #4b89b1;
  }
  code,
  pre {
    color: #ddd;
  }
  .main-header {
    background-color: #4b89b1;
  }
}
#hexo-amp-id-1{position:relative;padding-bottom:66.6666%;margin-bottom:1rem}#hexo-amp-id-2{position:relative;padding-bottom:49%;margin-bottom:1rem}
		
		amp-iframe {
			margin-bottom: 10px;
		}
	</style>
  </head>
  <body>

  	<!-- google analytics -->
  	
  	<amp-analytics type="googleanalytics" id="google-analytics">
		<script type="application/json">
		{
		  "vars": {
		    "account": "UA-39254352-1"
		  },
		  "triggers": {
		    "trackPageview": {
		      "on": "visible",
		      "request": "pageview"
		    }
		  }
		}
		</script>
	</amp-analytics>
	

  <header class="main-header">
      <nav id="menu">
          <a href="/">JMPerez Blog</a>
          <a href="/projects/">Projects</a>
          <a href="/talks/">Speaking</a>
          <a href="/about-me/">About</a>
      </nav>
  </header>

  <article>
  	<div class="post">
	  	<div id="page">

		    <article id="post-shades-of-pwa" class="post wrapper">

        <div class="media author">
          <div class="img">
            <a href="/about-me/">
              <amp-img src="/assets/images/jmperez.jpg" class="avatar-img" alt="" height="53" width="53">
            </a>
          </div>
          <div class="bd">
            <address class="name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/about-me/" itemprop="name">José M. Pérez</a></address>
            <meta class="post-data" itemprop="datePublished" content="2018-11-02T12:44:00.000Z">
              November 02 2018
            </meta>
          </div>
        </div>

				<!-- entry title -->
				<header class="entry-header">
					
					  <h1 class="article-title entry-title" itemprop="name">
					    The different shades of Progressive Web Apps
					  </h1>
					
				</header>

				<!-- entry content -->
			    <div class="entry-content ecp">
			  		<p>Implementing a PWA or adapting an existing site to &#x201C;become a PWA&#x201D; can be daunting. There are many new technologies to learn about, but you don&#x2019;t need to use all of them to improve your website performance and user experience greatly.</p><div id="hexo-amp-id-1"><div class="amp-img-wrapper"><amp-img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541172389/shades-of-pwa/header.jpg" width="700" height="467" layout="responsive"></amp-img></div></div><p>On this post I will describe several use cases where Progressive Web Apps (PWA) can be useful to make your website achieve better performance and be more reliable.</p><a id="more"></a><h2 id="What-are-Progressive-Web-Apps"><a href="#What-are-Progressive-Web-Apps" class="headerlink" title="What are Progressive Web Apps"></a>What are Progressive Web Apps</h2><p>If you are a web developer you have probably heard about Progressive Web Apps (PWA). Web sites that load quick, are reliable, feel smooth and take advantage of modern APIs.</p><p>There is a lot of buzz about them, partly because Google coined the term and has been leading the implementation of the bits and pieces that composed it.</p><p>Implementing a PWA or adapting an existing site to &#x201C;become a PWA&#x201D; looks like a big endeavor. The same powerful marketing that has made PWA known in the developer community can be a blessing and a curse. Developers might get the wrong idea that either they use everything and make installable offline-capable push notifications-enabled websites, or they bail out. After all, <strong>PWA is just a way to coin a set of recent browser APIs and techniques, not all or nothing</strong>.</p><p>Every website&#x2019;s use case is different and that is alright. If installing your website as an app is not something a user would do for your site, you don&#x2019;t need to build that capability. <strong>You can still take advantage of some of the technologies powering PWAs</strong>. The main requirement is that your site runs on HTTPS and, in most cases, creating a ServiceWorker, which is not more than a Javascript file.</p><p>I want to describe some of the typical scenarios where you can applied elements from PWAs.</p><h2 id="Common-Use-Cases-to-Apply-Service-Workers-and-other-PWA-related-functionality"><a href="#Common-Use-Cases-to-Apply-Service-Workers-and-other-PWA-related-functionality" class="headerlink" title="Common Use Cases to Apply Service Workers and other PWA-related functionality"></a>Common Use Cases to Apply Service Workers and other PWA-related functionality</h2><h3 id="Offline-mode-and-pre-caching"><a href="#Offline-mode-and-pre-caching" class="headerlink" title="Offline mode and pre-caching"></a>Offline mode and pre-caching</h3><p>To get your site to load without a connection, the user needs to visit it and the site needs to run a Service Worker (SW)that will make content available offline. The SW can follow different strategies (eg serving cache first, making a network request first, etc). You can find strategies on <a href="https://jakearchibald.com/2014/offline-cookbook/" target="_blank" rel="noopener">Jake Archibald&#x2019;s Offline Cookbook</a> and <a href="https://serviceworke.rs/" target="_blank" rel="noopener">serviceworke.rs</a>.</p><div id="hexo-amp-id-2"><div class="amp-img-wrapper"><amp-img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png" width="700" height="343" layout="responsive"></amp-img></div></div><p><small class="caption">&#x201C;Stale-while-revalidate&#x201D; strategy, of the many explained on <a href="https://jakearchibald.com/2014/offline-cookbook/" target="_blank" rel="noopener">Jake Archibald&#x2019;s Offline Cookbook</a>. If there&#x2019;s a cached version available, use it, but fetch an update for next time.</small></p><p>The strategies that check the cache first can be used to fetch and pre-cache top-level navigation routes and other critical resources. Thus, the user gets a faster loading and rendering experience as they click around the PWA.</p><p>Offline support is something that can be added pretty much to any site, big or small. I run <a href="https://jmperezperez.com/sw.js">a simple SW</a> <a href="https://jmperezperez.com">on my blog</a> to download the main sections and the posts that the user reads.</p><pre class=" language-js"><code class="language-js"><span class="token comment">// the cache version gets updated every time there is a new deployment</span>
<span class="token keyword">const</span> CACHE_VERSION <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CURRENT_CACHE <span class="token operator">=</span> <span class="token template-string"><span class="token string">`main-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>CACHE_VERSION<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// these are the routes we are going to cache for offline support</span>
<span class="token keyword">const</span> cacheFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/about-me/&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/projects/&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/offline/&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// on activation we clean up the previously registered service workers</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&apos;activate&apos;</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">&gt;</span>
  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
        cacheNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>cacheName <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheName <span class="token operator">!==</span> CURRENT_CACHE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// on install we download the routes we want to cache for offline</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&apos;install&apos;</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">&gt;</span>
  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>cacheFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fetch the resource from the network</span>
<span class="token keyword">const</span> fromNetwork <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fulfill<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fulfill</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fetch the resource from the browser cache</span>
<span class="token keyword">const</span> fromCache <span class="token operator">=</span> request <span class="token operator">=</span><span class="token operator">&gt;</span>
  caches
    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">&gt;</span>
      cache
        <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>matching <span class="token operator">=</span><span class="token operator">&gt;</span> matching <span class="token operator">||</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">&apos;/offline/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cache the current page to make it available for offline</span>
<span class="token keyword">const</span> update <span class="token operator">=</span> request <span class="token operator">=</span><span class="token operator">&gt;</span>
  caches
    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">&gt;</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// general strategy when making a request (eg if online try to fetch it</span>
<span class="token comment">// from the network with a timeout, if something fails serve from cache)</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&apos;fetch&apos;</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  evt<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    <span class="token function">fromNetwork</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">fromCache</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token function">update</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>With great power comes great responsibility. Do not use SWs to abuse the user&#x2019;s data connection, downloading content they will never need, just in case.</p><h3 id="Service-Workers-for-Multi-page-Applications"><a href="#Service-Workers-for-Multi-page-Applications" class="headerlink" title="Service Workers for Multi-page Applications"></a>Service Workers for Multi-page Applications</h3><p>In a multi-page app (MPA), every route that a user navigates to triggers a full request of the page, along with associated scripts and styles needed, to the server.</p><p>A good example is <a href="https://ele.me" target="_blank" rel="noopener">ele.me</a>, the biggest food ordering and delivery company in mainland China. They used a SW to precache the main routes from their site, and implemented skeleton screens that are immediately shown while loading routes that aren&#x2019;t cached.</p><div><div class="amp-img-wrapper"><amp-img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:350,f_auto,c_scale,w_600/v1541171672/shades-of-pwa/ele-me-skeleton-page.png" width="600" height="1067" layout="responsive"></amp-img></div> <div class="amp-img-wrapper"><amp-img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:350,f_auto,c_scale,w_600/v1541171587/shades-of-pwa/ele-me-full-load.png" width="600" height="1067" layout="responsive"></amp-img></div></div><p>You can read more about their approach on <a href="https://developers.google.com/web/showcase/2017/eleme" target="_blank" rel="noopener">Google Developers site</a> and <a href="https://medium.com/elemefe/upgrading-ele-me-to-progressive-web-app-2a446832e509" target="_blank" rel="noopener">this in-depth post</a>.</p><h3 id="Bridging-the-gap-between-SPAs-and-server-side-rendered-sites"><a href="#Bridging-the-gap-between-SPAs-and-server-side-rendered-sites" class="headerlink" title="Bridging the gap between SPAs and server-side rendered sites"></a>Bridging the gap between SPAs and server-side rendered sites</h3><p>Web development has gone through different stages</p><ol><li>Old sites used to be server-side rendered. Only minor interactions used Javascript in the client. Every page navigation meant a full page load.</li><li>Then we started creating more complex web experiences and moved all the logic (and templates) to client-side land. Everything was amazing as long as you waited a bit while staring at a blank page whose main purpose was to load a large JS bundle.</li><li>We realized that maybe we needed a hybrid solution. First request server-side rendered, then the rest happening client-side.</li></ol><p><strong>Reaching the third step involves doing server-side rendering.</strong> If you don&#x2019;t want to duplicate templates and logic, the usual solution is to use NodeJS on the server. This is fun for web developers because we get to use the same language both on server and browser. In medium and large web projects it means rewriting existing working code from python/java/PHP/others to Javascript, and the typical nuances of adopting something different from the existing solution.</p><p>Server-side rendered sites have also a largely underestimated drawback. <strong>Putting content early on the screen is one thing. Making the content interactive is another.</strong> A page that renders quickly but then doesn&#x2019;t respond to click/touch for seconds, while loads and executes the JS behemoth, results in frustration.</p><p>In web dev terms we are improving the <a href="https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint" target="_blank" rel="noopener">First Meaningful Paint</a> (&#x2018;FMP&#x2019;), but we aren&#x2019;t making any improvement in the <a href="https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive" target="_blank" rel="noopener">Time to Interactive</a> (&#x2018;TTI&#x2019;).</p><p>This short version of Addy Osmani&#x2019;s &#x201C;The cost of JavaScript&#x201C; explains it very well:</p><div class="videoWrapper"><amp-youtube data-videoid="qUFA1pAMfj4" width="1920" height="1080" layout="responsive"></amp-youtube></div><p><small class="caption">&#x201C;<a href="https://www.youtube.com/watch?v=qUFA1pAMfj4" target="_blank" rel="noopener">The cost of JavaScript</a>&#x201D; by Addy Osmani. If you like it, there is also <a href="https://www.youtube.com/watch?v=63I-mEuSvGA" target="_blank" rel="noopener">a longer version of the talk.</a></small></p><p>Paul Lewis also described the situation in his post &#x201C;<a href="https://aerotwist.com/blog/when-everything-is-important-nothing-is/" target="_blank" rel="noopener">When everything is important nothing is</a>&#x201D;, and describes it as the <em>Uncanny Valley.</em></p><div class="amp-img-wrapper"><amp-img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg" width="700" height="428" layout="responsive"></amp-img></div> <small class="caption">Rendering your app server-side. An image from &#x201C;<a href="https://aerotwist.com/blog/when-everything-is-important-nothing-is/" target="_blank" rel="noopener">When everything is important nothing is</a>&#x201D;.</small><p>I have seen many cases when server-side rendering was proposed as the first step to improve the performance in a SPA. This left off the table ideas like bundle-splitting, which would have likely reduced both FMP and TTI.</p><blockquote><p>[&#x2026;] <strong>you should avoid SSR if you don&#x2019;t need it.</strong> Most modern web apps require sophisticated interaction with the UI that has to be driven by non-trivial amounts of JavaScript. If you need to write all of that JS anyway, and you <em>don&#x2019;t</em> need the first page load benefits that SSR gives you, you&#x2019;ll be better off just building a <a href="https://developers.google.com/web/fundamentals/architecture/app-shell" target="_blank" rel="noopener">static app shell</a> and avoiding the headaches of client-server code reuse, data re-hydration, and dynamic content cache invalidation.&#x200A;&#x2014;&#x200A;<a href="https://blog.usejournal.com/when-should-i-server-side-render-c2a383ff2d0f" target="_blank" rel="noopener">When should I Server-Side Render?</a> by <a href="https://blog.usejournal.com/@mbleigh" target="_blank" rel="noopener">Michael Bleigh</a></p></blockquote><p>Single Page Applications that are not server-side rendered can take great advantage from using Service Workers. In most cases the browser requests some data and injects it in a JS template or component. This means that the browser can cache the JS code and the data independently.</p><p>The site can then follow different strategies. For instance, it can load immediately with stale data, similar to what usually happens with native apps. It can also decide to render a skeleton while the data is fetched. In any case, it makes an approach like <a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/" target="_blank" rel="noopener">PRPL</a>, easy to implement.</p><h3 id="Installable-Website"><a href="#Installable-Website" class="headerlink" title="Installable Website"></a>Installable Website</h3><p>You might want to make your website installable, close to what everyone knows as an &#x201C;app&#x201D;. For this you don&#x2019;t need many to use many capabilities from the web. As long as your site runs on HTTPS you just need a web manifest, an icon and a ServiceWorker. You can find documentation on <a href="https://developers.google.com/web/fundamentals/app-install-banners/" target="_blank" rel="noopener">Google&#x2019;s Developer site</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/Apps/Progressive/Installable_PWAs" target="_blank" rel="noopener">MDN</a>.</p><p>Your site doesn&#x2019;t need to be fully functional offline to make it installable. Take for instance Spotify&#x2019;s Progressive Web App.</p><div class="videoWrapper"><amp-youtube data-videoid="EvcjSldzQ1E" width="1920" height="1080" layout="responsive"></amp-youtube></div><p><small class="caption">Spotify&#x2019;s Web Player works as an installable PWA.</small></p><p>As you see, the PWA is installable, yet it doesn&#x2019;t have support for offline navigation nor playback. When there is no connection, the PWA shows this custom page:</p><div class="amp-img-wrapper"><amp-img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541171689/shades-of-pwa/spotify-offline.png" width="700" height="451" layout="responsive"></amp-img></div><p>Installable PWAs are not limited to mobile. They are already supported on <a href="https://developers.google.com/web/progressive-web-apps/desktop" target="_blank" rel="noopener">ChromeOS, Windows and Linux</a>, and pretty soon on Mac too (Chrome 72+).</p><h4 id="More-features-enabled-by-Service-Workers"><a href="#More-features-enabled-by-Service-Workers" class="headerlink" title="More features enabled by Service Workers"></a>More features enabled by Service Workers</h4><p>I have only talked about some use cases for ServiceWorkers and other elements of PWAs, but there are more. Browsers can show <a href="https://developers.google.com/web/fundamentals/push-notifications/" target="_blank" rel="noopener">push notifications</a> after the user has enabled it for a certain site, and the push notifications are delivered even when the site is not opened. This makes it ideal for reengage with users without having to wait for them to visit your site again.</p><p>You can also use <a href="https://developers.google.com/web/updates/2015/12/background-sync" target="_blank" rel="noopener">background sync</a>, ideally for schedule data sending beyond the life of the page. Think of uploading pictures or sending chat messages even after the user leaves the page.</p><h3 id="More-Resources"><a href="#More-Resources" class="headerlink" title="More Resources"></a>More Resources</h3><p>I love reading about real sites that have adopted PWAs and have shared their findings. I particularly like <a href="https://www.youtube.com/watch?v=aCMbSyngXB4" target="_blank" rel="noopener">Addy Osmani&#x2019;s talk &#x201C;Production Progressive Web Apps With JavaScript Frameworks&#x201D;</a>, showcasing some case studies from large web sites that have been integrating these technologies to improve their key metrics.</p><div class="videoWrapper"><amp-youtube data-videoid="aCMbSyngXB4" width="1920" height="1080" layout="responsive"></amp-youtube></div><p>They are good examples to demonstrate that you don&#x2019;t need to re-architecture an existing site to use PWA goodness, and that you can apply some of these concepts and see improvements in perceived performance very quickly.</p>
			  	</div>

		  	</article>
		</div>
    <footer>
        <section class="links">
            <a href="https://twitter.com/jmperezperez">@jmperezperez</a> on Twitter · <a href="https://github.com/JMPerez">GitHub</a> · <a href="http://www.linkedin.com/in/jmperezperez">LinkedIn</a>
        </section>
    </footer>

	</div>
  </article>

  </body>
</html>
